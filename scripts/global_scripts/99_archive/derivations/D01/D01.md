---
id: "D01"
title: "DNA Analysis Derivation Flow"
type: "derivation"
date_created: "2025-04-07"
date_modified: "2025-04-07"
author: "Claude"
related_to:
  - "R38": "Platform Numbering Convention"
  - "R39": "Derivation Platform Independence"
  - "R41": "Derivation Folder Structure"
---

# D01: DNA Analysis Derivation Flow

This document outlines the platform-independent DNA analysis derivation process, detailing the step-by-step transformation of raw sales data to analytics-ready customer DNA profiles across any sales platform.

## Derivation Steps

### D01_00: Import External Raw Data
```
import external_raw_data.{sales_data} to raw_data.df_{source}_sales
```
- Imports raw sales data from external source
- Creates initial dataframe in the raw_data schema
- Preserves source-specific attributes for later analysis

### D01_01: Cleanse Raw Data
```
cleanse raw_data.df_{source}_sales to cleansed_data.df_{source}_sales
```
- Removes invalid entries
- Corrects formatting issues
- Transforms time fields to proper time format
- Standardizes text fields

### D01_02: Standardize Cleansed Data
```
standardize cleansed_data.df_{source}_sales to processed_data.df_{source}_sales
```
- Normalizes values to common units
- Applies business rules
- Enforces data type consistency
- Sets up dimensional hierarchy
- Performs required data type conversions:
  - Converts `customer_id` to integer type
  - Ensures `time` is in proper datetime format
  - Converts amount/price fields to numeric values
- Handles missing values with appropriate imputation strategies
- Validates output schema to ensure compatibility with DNA analysis

### D01_03: Transform to Customer View
```
transform processed_data.df_{source}_sales to processed_data.df_{source}_sales_by_customer_id
```
- Maps and standardizes column names to required DNA function fields:
  - `customer_id`: Customer unique identifier 
  - `time`: Transaction timestamp
  - `times`: Sequential transaction count per customer
  - `total`: Transaction amount
  - `IPT`: Inter-purchase time in days
  - `location`: Customer location information
- Calculates customer-level metrics:
  - Total purchase amount (`total_sum`)
  - Purchase frequency (`ni`)
  - Average inter-purchase time (`IPT_mean`)
  - Variance measures (`sigma_HNorm_mle`, `sigma_HNorm_bcmle`)
  - First purchase time and amount (`time_First`, `NT`)
  - Time since first purchase (`time_FirstTonow`)
- Creates customer-centric view with one row per customer
- Performs transaction sequence analysis
- Calculates percentile ranks and distributions for key metrics
- Prepares the appropriate data structure for DNA analysis
- Enforces consistent data types across aggregated columns

### D01_04: Analyze Customer DNA
```
analyze dna of processed_data.df_{source}_sales_by_customer_id to processed_data.df_{source}_sales_by_customer_id___dna
```
- Extracts behavioral patterns
- Identifies preference indicators
- Calculates propensity scores
- Builds comprehensive customer DNA profile
- Initializes global parameters for DNA analysis:
  - `delta`: Discount factor (0.1 default)
  - `ni_threshold`: Minimum transaction threshold (5 default)
  - Break points for segmentation:
    - `NESbreaks`: c(0.5, 1.5, Inf)
    - `Mbreaks`: seq(0, 1, 0.25)
    - `Fbreaks`: c(1, 5, 10, Inf)
    - `Rbreaks`: seq(0, 1, 0.25)
    - `CAIbreaks`: seq(0, 1, 0.25)
  - Labels for segment bins:
    - `textNESlabel`: c("E0", "S", "L")
    - `textMlabel`: c("M1", "M2", "M3", "M4")
    - `textFlabel`: c("F1", "F2", "F3")
    - `textRlabel`: c("R4", "R3", "R2", "R1")
    - `textCAIlabel`: c("CA1", "CA2", "CA3", "CA4")

### D01_05: Publish for Application Use
```
copy processed_data.df_{source}_sales_by_customer_id___dna to app_data.processed_data.df_{source}_sales_by_customer_id
```
- Makes DNA profiles available to application
- Ensures proper schema placement
- Preserves analytical structure
- Enables application access to processed results

### D01_90: Integrate Platform Data
```
merge_all 
  processed_data.df_{source1}_sales_by_customer_id___dna, 
  processed_data.df_{source2}_sales_by_customer_id___dna
  [...]
to 
  processed_data.df_all_platforms_by_customer_id___dna
```
- Combines DNA profiles from multiple platforms
- Resolves customer identity across platforms
- Creates unified customer view
- Applies cross-platform weighting for metrics
- Ensures consistent data schema

### D01_91: Analyze Cross-Platform Behaviors
```
analyze cross_platform_behavior of
  processed_data.df_all_platforms_by_customer_id___dna
to
  processed_data.df_all_platforms_by_customer_id___cross_platform_dna
```
- Identifies platform switching behaviors
- Calculates platform preference scores
- Analyzes customer journey across touchpoints
- Determines channel effectiveness
- Provides comprehensive cross-channel DNA profile

## Platform Implementations

Platform-specific implementations of this derivation can be found in the respective platform directories:

- 01 (Amazon): `platforms/01/`
- 06 (eBay): `platforms/06/` 
- 07 (Cyberbiz): `platforms/07/`